<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Testing &middot; Data wRangling for Ecologists
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/wRangling-Ecology/public/css/poole.css">
  <link rel="stylesheet" href="/wRangling-Ecology/public/css/syntax.css">
  <link rel="stylesheet" href="/wRangling-Ecology/public/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/wRangling-Ecology/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/wRangling-Ecology/public/favicon-2.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-89257505-1', 'auto');
    ga('send', 'pageview');

  </script>

</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar">
    <div class="sidebar-about">
      <h1>
        <a href="/wRangling-Ecology/">
          Data wRangling for Ecologists
        </a>
      </h1>
      <p class="lead">Using data science tools for exploration, analysis, and research</p>
    </div>
    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/wRangling-Ecology/nav/getting-started"><i class="fa fa-play fa-fw"></i> Getting Started</a>
      <a class="sidebar-nav-item" href="/wRangling-Ecology/nav/course-materials"><i class="fa fa-briefcase fa-fw"></i> Course Materials</a>
      <a class="sidebar-nav-item" href="/wRangling-Ecology/schedule"><i class="fa fa-calendar fa-fw"></i> Schedule</a>
      <a class="sidebar-nav-item" href="/wRangling-Ecology/nav/about"><i class="fa fa-user fa-fw"></i> About / Contact Us</a>
      <a class="sidebar-nav-item" href="/wRangling-Ecology/in-class-feedback"><i class="fa fa-bullhorn fa-fw"></i> In-class Feedback</a>
    </nav>

    <p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="/wRangling-Ecology/public/cc-by-80x15.png" /></a></p>
  </div>
</div>


    <div class="content container">
      <div class="page-header">
  <h1 class="page-title">Testing</h1>
  <h2 class="page-subtitle"></h2>
  <hr width="75%">
</div>

<div class="page-content">
  <h2 id="what-is-testing">What is testing?</h2>
<ul>
  <li>Testing checks to make sure if our code is doing what we think it is.</li>
  <li>Does so in a automated fashion</li>
  <li>So that once we tell the computer what to check for, it does the checking itself</li>
</ul>

<h2 id="why-test">Why test?</h2>
<ol>
  <li>Make sure that your code is giving you the correct output on simple cases</li>
  <li>Prevent regressions</li>
  <li>Prevent changes when someone else’s code updates</li>
  <li><strong>Don’t publish the wrong answer because of a bug -&gt; <a href="http://www.jstor.org/stable/25145087">like this</a></strong></li>
</ol>

<h2 id="writing-tests-for-nose">Writing tests for Nose</h2>
<p>Create a file whose name begins with the word test (same directory as code to be tested)</p>

<p>Create new my_math.py file:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>def add(num1, num2):
    return num1 + num2

def divide(numerator, denominator):
    return numerator / denominator
</code></pre>
</div>

<p>Create new test_my_math.py file</p>

<p>Import anything the code needs (including the module to be tested)</p>

<p><em>Add</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>import my_math
</code></pre>
</div>

<p>Write functions beginning with test that assert something:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>def test_add_integers():
    assert add(2, 3) == 5
</code></pre>
</div>

<h2 id="running-tests-using-nose">Running tests using nose</h2>
<ul>
  <li>Run <code class="highlighter-rouge">nosetests</code> from the command line
    <ul>
      <li>Using -v for more explanation</li>
    </ul>
  </li>
  <li>
    <p>Use nose.run() from inside the function</p>

    <p>def test_add_ints_zero() == 2:
      assert add(2, 0) == 2</p>
  </li>
</ul>

<h2 id="when-tests-fail">When tests fail</h2>
<div class="highlighter-rouge"><pre class="highlight"><code>def test_div_integers():
    assert divide(1, 4) == 0.25
</code></pre>
</div>

<p><em>Run tests, fix integer division</em></p>

<p><em>Add</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>def test_div_integers_noneven():
    assert divide(1, 3) == 0.3333
</code></pre>
</div>

<p><em>Run tests, add more 3s</em></p>

<p><em>Add</em></p>

<div class="highlighter-rouge"><pre class="highlight"><code>import nose
nose.tools.assert_almost_equals(divide(1,3), 0.3333333)
</code></pre>
</div>

<h2 id="testing-errors">Testing errors</h2>

<p>We often want to know how to make sure that our code is throwing errors when
it should be. For example, if something goes wrong with a data file we don’t
want the code to execute and potentially produce an incorrect result. However,
since all of our testing is based on errors any error in our code will typically
cause the test to fail. To address this an other issues nose has lots of useful
functions for testing (<em>walk through some examples</em>). The one we are looking for
here is <code class="highlighter-rouge">nose.tools.assert_raises()</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>def test_add_strings():
    nose.tools.assert_raises(ValueError, add, 'stuff', 'things')
</code></pre>
</div>

<p>Alternatively we can use the <code class="highlighter-rouge">@raises</code> decorator.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>@raises(TypeError)
def test_add_lists():
    a = add([1, 2], [3, 4])
</code></pre>
</div>

<p>I often don’t remember what the different error types are, so I will typically
trigger the error, make sure the error type makes sense, and then add it to my
test.</p>

<p><strong>Try adding a test for adding a string and a number</strong></p>

<h2 id="testing-multiple-values">Testing multiple values</h2>
<p>There are some cases where we will want to test multiple values in a single test
rather than writing separate tests for each set of values. We could loop over
the values, but this will stop after the first failure. Instead, we can do this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>def test_add_badvalues():
    values = [['teststring', 2], [0, 'teststring'], ['stuff', 'things']]
    for val1, val2 in values:
        yield check_badvalues, val1, val2

def check_badvalues(val1, val2):
    nose.tools.assert_raises(ValueError, add, val1, val2)
</code></pre>
</div>

<p>We can see from the results that this runs and counts 3 separate tests. If one
of these tests fails, e.g.,</p>

<div class="highlighter-rouge"><pre class="highlight"><code>def test_add_badvalues():
    values = [['teststring', 2], [2, 1], [0, 'teststring'], ['stuff', 'things']]
    for val1, val2 in values:
        yield check_badvalues, val1, val2
</code></pre>
</div>

<p>Not only will all of the other tests still run, but nose will tell us the
values that caused the test to fail.</p>

<p>###What is <code class="highlighter-rouge">yield</code>
<code class="highlighter-rouge">yield</code> is like return, but the function will return a generator. This means
that when you call the function, the code doesn’t actually execute. Instead,
the function returns the generator object. The first time the function is run,
it will run until it hits yield, then it will return the first value of the
loop. Then, each additional call will run the loop in the function another time,
and return the next value, until there is no value to return. So, 
<code class="highlighter-rouge">test_add_badvalues()</code> ends up being run once for every trip through the for
loop, which is why it doesn’t stop at the first error.</p>

<p>Source: http://stackoverflow.com/a/231855/133513</p>

<h2 id="integrationregression-testing">Integration/regression testing</h2>
<p>Calls higher level functionality and checks the results.
E.g., tax_resolve tests</p>

</div>

    </div>

  </body>
</html>
