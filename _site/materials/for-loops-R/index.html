<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      for loops &middot; Data wRangling for Ecologists
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/wRangling-Ecology/public/css/poole.css">
  <link rel="stylesheet" href="/wRangling-Ecology/public/css/syntax.css">
  <link rel="stylesheet" href="/wRangling-Ecology/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/wRangling-Ecology/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/wRangling-Ecology/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-68320080-1', 'auto');
    ga('send', 'pageview');

  </script>

</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar">
    <div class="sidebar-about">
      <h1>
        <a href="/wRangling-Ecology/">
          Data wRangling for Ecologists
        </a>
      </h1>
      <p class="lead">Using data science tools for exploration, analysis, and research</p>
    </div>
    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/wRangling-Ecology/nav/getting-started"><i class="fa fa-play fa-fw"></i> Getting Started</a>
      <a class="sidebar-nav-item" href="/wRangling-Ecology/nav/course-materials"><i class="fa fa-briefcase fa-fw"></i> Course Materials</a>
      <a class="sidebar-nav-item" href="/wRangling-Ecology/schedule"><i class="fa fa-calendar fa-fw"></i> Schedule</a>
      <a class="sidebar-nav-item" href="/wRangling-Ecology/nav/about"><i class="fa fa-user fa-fw"></i> About / Contact Us</a>
      <a class="sidebar-nav-item" href="/wRangling-Ecology/in-class-feedback"><i class="fa fa-bullhorn fa-fw"></i> In-class Feedback</a>
    </nav>

    <p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="/wRangling-Ecology/public/cc-by-80x15.png" /></a></p>
  </div>
</div>


    <div class="content container">
      <div class="page-header">
  <h1 class="page-title">for loops</h1>
  <h2 class="page-subtitle">Notes</h2>
  <hr width="75%">
</div>

<div class="page-content">
  <blockquote>
  <p>Set up R console:</p>
</blockquote>

<div class="highlighter-rouge"><pre class="highlight"><code>library(stringr)
library(dplyr)
</code></pre>
</div>

<h3 id="basic-for-loop">Basic <code class="highlighter-rouge">for</code> loop</h3>

<ul>
  <li>Repeats action for a number of different values</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>for (item in list_of_items) {
  do_something(item)
}
</code></pre>
</div>

<ul>
  <li>Make sure you know what values you are calling in your loop.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>pets &lt;- c("spot", "gigantor", "fluffy")
for (pet in pets) {
  print(pet)
}
</code></pre>
</div>

<ul>
  <li>Need <code class="highlighter-rouge">print()</code> to display values inside a loop, function, or conditional.</li>
  <li>Long-form expression of the previous loop</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>pets &lt;- c("spot", "gigantor", "fluffy")
pet &lt;- pets[1]
print(pet)
pet &lt;- pets[2]
print(pet)
pet &lt;- pets[3]
print(pet)
</code></pre>
</div>

<ul>
  <li>Do more things.</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>pets &lt;- c("spot", "gigantor", "fluffy")
for (pet in pets) {
  pet_upper &lt;- str_to_upper(pet)
  print(pet_upper)
}
</code></pre>
</div>
<blockquote>
  <p>Do <a href="/wRangling-Ecology/exercises/Loops-basic-index-R/">Exercise 1 - Basic Index</a> and <a href="/wRangling-Ecology/exercises/Loops-basic-vector-R/">Exercise 2 - Basic Vector</a>.</p>
</blockquote>

<blockquote>
  <p>Make sure students get the basics before moving on.</p>
</blockquote>

<blockquote>
  <p>Do <a href="/wRangling-Ecology/exercises/Functions-for-loop-R">Exercise 3.1 - for Loop</a>.</p>
</blockquote>

<h3 id="storing-results">Storing results</h3>

<ul>
  <li>Create an empty object.
    <ul>
      <li><code class="highlighter-rouge">output &lt;- c()</code></li>
    </ul>
  </li>
  <li>Add the new values with vector combination each trip through the loop.
    <ul>
      <li><code class="highlighter-rouge">c(c(1, 2, 3), 4) -&gt; [1] 1 2 3 4</code></li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>pets &lt;- c("spot", "gigantor", "fluffy")
upper_case_pets &lt;- c()
for (pet in pets){
  pet_upper &lt;- str_to_upper(pet)
  upper_case_pets &lt;- c(upper_case_pets, pet_upper)
  print(upper_case_pets)
}
</code></pre>
</div>

<h3 id="looping-in-data-frames">Looping in data frames</h3>

<ul>
  <li>By default data frames loop over columns</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>pets &lt;- data.frame(pet_name = c("spot", "gigantor", "fluffy"),
                   pet_type = c("fish", "hamster", "lizard"))
for (pet in pets){
  print("Start new loop")
  print(pet)
}
</code></pre>
</div>

<ul>
  <li>Who has seen/used a different approach to looping than has been show?</li>
  <li>That’s called looping over an <code class="highlighter-rouge">index</code> and while it’s overly complicated for
simple loops it’s useful for more complicated things like looping over rows</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>pets &lt;- data.frame(pet_name = c("spot", "gigantor", "fluffy"),
                   pet_type = c("fish", "hamster", "lizard"))
for (i in 1:nrow(pets)){
  print(paste(pets$pet_name[i], " is a ", pets$pet_type[i], sep =""))
}
</code></pre>
</div>

<ul>
  <li>We can also use the index to store the output by pre-allocating memory</li>
  <li>This is a lot faster than adding rows because it doesn’t copy the data frame
every time through the loop</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>output &lt;- data.frame(name = character(3), namelength = numeric(3),
                     stringsAsFactors = FALSE)
for (i in 1:nrow(pets)) {
  pet_upper &lt;- str_to_upper(pets$pet_name[i])
  pet_length &lt;- str_length(pets$pet_type[i])
  output[i,] &lt;- c(pet_upper, pet_length)
}
</code></pre>
</div>

<blockquote>
  <p>Assign <a href="/wRangling-Ecology/exercises/Loops-stringr-R">Exercise 4 - stringr</a>.
Assign <a href="/wRangling-Ecology/exercises/Making-choices-dna-or-rna-R">Exercise 5 - DNA or RNA</a>.</p>
</blockquote>

<h3 id="alternatives-to-loops">Alternatives to loops</h3>

<h4 id="vectorization">Vectorization</h4>

<ul>
  <li>Operations that work on all of the elements in a vector</li>
  <li>Make functions that work with vectors so no need to loop over values</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>lengths &lt;- c(2.26, 1.48, 3.84)
mass &lt;- 0.73 * length ** 3.63
mass
</code></pre>
</div>

<ul>
  <li>Works for most simple math</li>
</ul>

<h4 id="looping-over-files">Looping over files</h4>

<ul>
  <li>To learn alternatives learn how to do the same thing with many files. First
with loops and then with some alternatives in R</li>
  <li>E.g., we have a set of files with satellite collar location data</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>date,time,lat,long
2016-01-01,4:20,26.16,-35.28
</code></pre>
</div>

<ul>
  <li>To get a list of all these files in our <code class="highlighter-rouge">data</code> directory use <code class="highlighter-rouge">list.files()</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>download.file("http://www.datacarpentry.org/semester-biology/data/collar-data-2016-01.zip")
unzip("collar-data-2016-01.zip")
list.files()
collar_data_files &lt;- list.files("collar-data-2016-01", 
                                pattern="collar-data-.*.txt",
                                full.names=TRUE)
</code></pre>
</div>

<ul>
  <li>Using the <code class="highlighter-rouge">pattern</code> argument makes file structure clear and avoids errors</li>
  <li><code class="highlighter-rouge">full.names = TRUE</code> retains directory information</li>
  <li>Now we can loop over the files to work with them</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>num_samps &lt;- c()
for (data_file in collar_data_files){
  data &lt;- read.csv(data_file)
  samples &lt;- nrow(data)
  num_samps &lt;- c(num_samps, samples) 
}
num_samps
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>get_num_samps &lt;- function(data_file_name){
  data &lt;- read.csv(data_file_name)
  samples &lt;- nrow(data)
  return(samples)
}

num_samps &lt;- c()
for (data_file in collar_data_files){
  num_samps &lt;- c(num_samps, get_num_samps(data_file))
}
num_samps
</code></pre>
</div>

<h4 id="applymap">apply/map</h4>

<ul>
  <li>Since: 1) create empty object, 2) loop, 3) add result to storage object; is so
common, many languages have a shortcut for use in simple situations.</li>
  <li>In R the main version this is the <code class="highlighter-rouge">apply</code> family</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>num_samps = sapply(collar_data_files, get_num_samps)
</code></pre>
</div>

<ul>
  <li>There are a variety
of <a href="http://finzi.psych.upenn.edu/R/library/base/html/apply.html"><code class="highlighter-rouge">apply()</code></a>
statements that handle different use cases
    <ul>
      <li><a href="http://finzi.psych.upenn.edu/R/library/base/html/lapply.html"><code class="highlighter-rouge">lapply()</code></a>: Operate across lists and vectors</li>
      <li><a href="http://finzi.psych.upenn.edu/R/library/base/html/lapply.html"><code class="highlighter-rouge">sapply()</code></a>: Simplify output to vector</li>
      <li><a href="http://finzi.psych.upenn.edu/R/library/base/html/mapply.html"><code class="highlighter-rouge">mapply()</code></a>: Pass multiple variables or function arguments</li>
    </ul>
  </li>
  <li>Why use <code class="highlighter-rouge">apply()</code>:
    <ul>
      <li>Readability
        <ul>
          <li>Single line of code</li>
          <li>Simple command structure</li>
        </ul>
      </li>
      <li>Speed?
        <ul>
          <li>Only
(<a href="https://stackoverflow.com/questions/2275896/is-rs-apply-family-more-than-syntactic-sugar">sometimes</a>)
and even then often not enough to matter.</li>
          <li><a href="http://c2.com/cgi/wiki?PrematureOptimization">Avoid premature optimization</a>.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>In a number of other languages this is called <code class="highlighter-rouge">map()</code></li>
  <li>There is now a <code class="highlighter-rouge">map()</code> for R that works similarly in the <code class="highlighter-rouge">purrr</code> package</li>
</ul>

<h4 id="dplyr">dplyr</h4>

<ul>
  <li>Use <code class="highlighter-rouge">rowwise()</code> to get <code class="highlighter-rouge">dplyr</code> to run the function on each row</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>num_samps &lt;- data.frame(myfiles, stringsAsFactors=FALSE) %&gt;%
  rowwise() %&gt;%
  mutate(samples = get_num_samps(myfiles))
</code></pre>
</div>

<ul>
  <li>This is an example of why to use <code class="highlighter-rouge">stringsAsFactors=FALSE</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>num_samps &lt;- data.frame(myfiles) %&gt;%
  rowwise() %&gt;%
  mutate(samples = get_num_samps(myfiles))
</code></pre>
</div>

<ul>
  <li>Instead of passing the file names this passes the integer values for the
levels</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>num_samps &lt;- data.frame(myfiles) %&gt;%
  rowwise() %&gt;%
  mutate(samples = typeof(myfiles))
</code></pre>
</div>


</div>

    </div>

  </body>
</html>
